import pip
import sys
import os

dependencies = []
weird_dependencies = ["yara-python"]


def weirdDepCheck(item):
    # Checks for weird installs like yara-python, which will pip install even if it's already installed
    py_path = sys.executable
    lib_path = f"{py_path}\\..\\Lib\\site-packages\\"
    if item == "yara-python":
        item = "yara_python"
    if any(p.startswith(item) for p in os.listdir(lib_path)):
        return True
    else:
        return False

def installDependencies():
    with open("dependencies.txt", "r") as d:
        for line in d:
            dependencies.append(line.rstrip("\n"))
    d.close()
    for item in dependencies:
        try:
            __import__(item)
        except ImportError:
            weird_check = False
            if item in weird_dependencies:
                weird_check = weirdDepCheck(item)
            if not weird_check:
                print("Installing dependency --> ", item) 
                pip.main(['install', item])

installDependencies()
